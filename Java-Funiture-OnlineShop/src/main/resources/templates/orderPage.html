<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>주문 페이지</title>
    <style>
        /* CSS 스타일링 코드 */
    </style>
</head>
<body>
<h1>주문 확인</h1>

<div id="order-form">
    <h2>주문 정보</h2>
    <form action="/orders/save" method="post">
        <!-- 구매자 정보 -->
        <label for="customerName">구매자 이름:</label>
        <span id="customerName"></span><br>

        <label for="customerEmail">구매자 이메일:</label>
        <span id="customerEmail"></span><br>

        <label for="customerPhone">구매자 전화번호:</label>
        <span id="customerPhone"></span><br><br>

        <!-- 받는 사람 정보 -->
        <label for="recipientName">받는 사람 이름:</label>
        <input type="text" id="recipientName" name="recipientName" required><br>

        <label for="shippingAddress">배송 주소:</label>
        <input type="text" id="shippingAddress" name="shippingAddress" required><br>

        <label for="recipientPhone">받는 사람 전화번호:</label>
        <input type="text" id="recipientPhone" name="recipientPhone" required><br><br>

        <!-- 판매 업체 정보 안내 -->
        <p>주문한 상품은 판매 업체에서 직접 배송됩니다.</p>
        <p>판매 업체 정보는 주문 완료 후 제공될 예정입니다.</p><br>

        <!-- 나이스페이먼츠 정보 -->
        <label for="totalProductPrice">총 상품 가격:</label>
        <span id="totalProductPrice"></span><br>

        <label for="shippingFee">배송비:</label>
        <span id="shippingFee"></span><br>

        <label for="totalPaymentAmount">총 결제 금액:</label>
        <span id="totalPaymentAmount"></span><br>

        <!-- 결제하기 버튼 -->
        <button onclick="submitForm()">결제하기</button>
    </form>
</div>

<script>
    function submitForm() {
        // 여기에 필요한 결제 정보 계산과 폼 전송 로직을 추가할 수 있습니다
        // 예를 들어 JavaScript를 사용하여 계산하거나 서버 측에 요청하여 계산 결과를 받아올 수 있습니다

        // 예시로 폼 전송하는 코드를 작성합니다
        document.querySelector('form').submit();
    }

    async function fillUserInfo() {
        try {
            const token = getCookie("token");
            const response = await fetch('/user/info', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': token
                }
            });
            const result = await response.json();

            if (result.success) {
                const userInfo = result.response;

                // 구매자 정보 표시
                document.getElementById("customerName").textContent = userInfo.username;
                document.getElementById("customerEmail").textContent = userInfo.email;
                document.getElementById("customerPhone").textContent = userInfo.phoneNumber;

                // 받는 사람 정보 입력 필드에 채우기
                document.getElementById("recipientName").value = userInfo.username; // 받는 사람 이름을 구매자와 동일하게 설정 (필요에 따라 수정 가능)
                document.getElementById("shippingAddress").value = userInfo.address;
                document.getElementById("recipientPhone").value = userInfo.phoneNumber; // 받는 사람 전화번호를 구매자와 동일하게 설정 (필요에 따라 수정 가능)

                // 나이스페이먼츠 정보 표시 (ajax에서 바로 db에서 price, shippingFee 가져오기)
                document.getElementById("totalProductPrice").textContent = 24000+"원";
                document.getElementById("shippingFee").textContent = 1500 + "원";
                document.getElementById("totalPaymentAmount").textContent = 25500 + "원";
            } else {
                alert("로그인을 해 주십시오.");
                console.log(result);
                location.href = "/";
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }


    function getCookie(name) {
        var cookieName = name + "=";
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            if (cookie.indexOf(cookieName) === 0) {
                return cookie.substring(cookieName.length, cookie.length);
            }
        }
        return null;
    }

    // 페이지 로드 시 구매자 정보 및 받는 사람 정보 채우기
    fillUserInfo();
</script>
</body>
</html>
