<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>상품 상세 페이지</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div th:if="${product != null}">
    <!-- 상품 정보 섹션 -->
    <div>
        <h1 th:text="${product.productName}">상품명</h1>
        <p th:text="${product.description}">상품 설명</p>
        <p>가격: <span id="basePrice" th:text="${product.price}">상품 가격</span>원</p>
        <p>배송비: <span th:text="${product.deliveryFee}">배송비</span>원</p>
        <div>
            <h3>상품 이미지</h3>
            <img th:src="@{${product.fileProduct.filePath}}" alt="상품 이미지" th:if="${product.fileProduct != null}">
        </div>
        <!-- 옵션 선택 섹션 -->
        <div th:if="${product.optionList != null}">
            <h3>옵션 선택</h3>
            <select id="optionSelect" name="optionSelect" onchange="updateTotalPrice()">
                <option th:each="option : ${product.optionList}"
                        th:value="${option.id}"
                        th:text="${option.optionName}"
                        th:data-price="${option.price}"
                        th:data-stock="${option.stockQuantity}"
                        th:data-product-id="${option.productId}"> <!-- productId 데이터 속성 추가 -->
                    옵션 명
                </option>
            </select>
        </div>
        <div id="totalPriceSection">
            <h3>총 가격: <span id="totalPrice"></span>원</h3>
        </div>
        <div>
            <button type="submit" id="addCartButton" onclick="addCart()">장바구니 추가</button>
        </div>
    </div>
</div>

<script>
    // 가격 업데이트 함수 (옵션 선택에 따라 총 가격을 계산)
    function updateTotalPrice() {
        var optionSelect = document.getElementById('optionSelect');
        var selectedOption = optionSelect.options[optionSelect.selectedIndex];
        var optionPrice = selectedOption.getAttribute('data-price');
        var productId = selectedOption.getAttribute('data-product-id'); // 상품 ID 가져오기
        var basePrice = document.getElementById('basePrice').textContent; // 상품 기본 가격을 HTML에서 가져옵니다.
        var totalPrice = parseInt(basePrice, 10) + parseInt(optionPrice, 10);

        document.getElementById('totalPrice').innerText = totalPrice; // '원' 텍스트는 HTML에 있으므로 여기에는 추가하지 않음
    }

    // 문서 로드 후 총 가격을 초기화
    document.addEventListener('DOMContentLoaded', function() {
        updateTotalPrice();
    });

    async function sendOption() {

    }
</script>
</body>
</html>
